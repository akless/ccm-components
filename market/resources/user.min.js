ccm.component({name:"user",config:{html:{logged_in:[{"class":"username",inner:"%%",tag:"span",title:"%%"},{"class":"logout",inner:"%%",onclick:"%%",tag:"button",title:"%%"}],logged_out:{"class":"login",inner:"%%",onclick:"%%",tag:"button",title:"%%"}},sign_on:"hbrsinfkaul",context:!0,logged_in:!1,texts:{login:"Login",login_title:"click here for login",logout:"Logout",logout_title:"click here for logout",username_title:"this is your username"}},Instance:function(){function n(n){for(var t=0;t<i.length;t++)i[t](n)}var t,e=null,o=null,i=[],l=this,c=!1,r=[];this.init=function(n){if(l.context){var e=ccm.context.find(l,"user");l.context=e&&e.context||e}t=l.sign_on,delete l.sign_on,n()},this.ready=function(n){l.logged_in&&l.login(),n()},this.renew_token=function(n){ccm.load(["https://kaul.inf.h-brs.de/login/login.php",{realm:"hbrsinfkaul"}],function(t){e&&(e.token=t.token),n&&n(t)})},this.render=function(n){function t(){l.login(function(){l.render()})}function e(){l.logout(function(){l.render()})}if(l.context)return l.context.render(n);var o=ccm.helper.element(l);l.isLoggedIn()?o.html(ccm.helper.html(l.html.logged_in,ccm.helper.val(l.data().key),ccm.helper.val(l.texts.username_title),ccm.helper.val(l.texts.logout),e,ccm.helper.val(l.texts.logout_title))):o.html(ccm.helper.html(l.html.logged_out,ccm.helper.val(l.texts.login),t,ccm.helper.val(l.texts.login_title))),l.lang&&l.lang.render(),n&&n()},this.login=function(i){function u(t,o,c){for(e={key:t,token:o,name:c};r.length>0;)ccm.helper.action(r.shift());ccm.helper.isInDOM(l)&&l.render(),i&&i(),n(!0)}if(l.context)return l.context.login(i);if(l.isLoggedIn())return void(i&&i());if(c)return r.push([l.login,i]);switch(c=!0,t){case"demo":ccm.load(["https://kaul.inf.h-brs.de/login/demo_login.php",{realm:"hbrsinfkaul"}],function(n){u(n.user,n.token)});break;case"hbrsinfkaul":l.renew_token(function(n){var t=n.expiration_seconds,e=1e3*t;o&&(window.clearTimeout(o),o=null),o=window.setTimeout(l.renew_token,e),u(n.user,n.token,n.name)})}},this.logout=function(o){function i(){e=null,ccm.helper.isInDOM(l)&&l.render(),o&&o(),n(!1)}if(l.context)return l.context.logout(o);if(!l.isLoggedIn())return void(o&&o());switch(t){case"demo":ccm.load(["https://logout@kaul.inf.h-brs.de/login/demo_logout.php",{realm:"hbrsinfkaul"}]),i();break;case"hbrsinfkaul":ccm.load(["https://logout@kaul.inf.h-brs.de/login/logout.php",{realm:"hbrsinfkaul"}]),i()}},this.isLoggedIn=function(){return l.context?l.context.isLoggedIn():!!e},this.data=function(){return l.context?l.context.data():e},this.getSignOn=function(){return l.context?l.context.getSignOn():t},this.addObserver=function(n){return l.context?l.context.addObserver(n):void i.push(n)}}});