ccm.component({index:"menu",config:{style:[ccm.load,"../menu/layouts/default.css"],html:[ccm.store,"../menu/templates.json"],onClick:function(entry,$content,instance){console.log(entry,$content,instance)}},Instance:function(){var self=this;var my;this.init=function(callback){if(self.data)return callback();var entries=[];self.childNodes.map(function(child){if(child.tagName&&child.tagName==="CCM-MENU-ENTRY")entries.push({label:child.getAttribute("label"),content:child.innerHTML})});self.data={entries:entries};callback()};this.ready=function(callback){my=ccm.helper.privatize(self,"html","data","bigdata","selected","onClick");callback()};this.render=function(callback){var $element=ccm.helper.element(self);ccm.helper.dataset(my.data,function(dataset){$element.html(ccm.helper.html(my.html.get("main")));var $entries=ccm.helper.find(self,".entries");var $content=ccm.helper.find(self,".content");dataset.entries.map(renderMenuEntry);ccm.helper.find(self,".noclick").click(function(event){event.stopPropagation()});if(my.selected)ccm.helper.find(self,".entry").get(my.selected-1).click();if(my.bigdata)my.bigdata.log("render",{data:ccm.helper.dataSource(my.data),selected:my.selected});if(callback)callback();function renderMenuEntry(entry,i){if(typeof entry==="string")entry={label:entry};if(ccm.helper.isDependency(entry.content))ccm.helper.solveDependency(entry,"content",callback);$entries.append(ccm.helper.html(my.html.get("entry"),{label:entry.label,onclick:click}));function callback(result){if(ccm.helper.isInstance(result)||ccm.helper.isComponent(result)){result.element=$content;if(ccm.helper.isInstance(result))result.parent=self}}function click(){var $entry=jQuery(this);entry.nr=i+1;if(my.bigdata)my.bigdata.log("click",{data:ccm.helper.dataSource(my.data),entry:entry,clear:$entry.hasClass("selected")});if($entry.hasClass("selected")){$content.html("");$entry.removeClass("selected");return}ccm.helper.find(self,".entry").removeClass("selected");$entry.addClass("selected");$content.html("");if(entry.content){if(ccm.helper.isInstance(entry.content)||ccm.helper.isComponent(entry.content))entry.content.render();else if(typeof entry.content==="object")return $content.html(ccm.helper.html(entry.content));else $content.html(ccm.helper.val(entry.content))}if(entry.actions)if(typeof entry.actions==="function")entry.actions();else entry.actions.map(function(action){ccm.helper.action(action)});if(my.onClick)my.onClick(entry,$content,self)}}})}}});