ccm.component({index:"market",config:{html:[ccm.store,"./resources/templates.json"],style:[ccm.load,"./resources/market.css"],store:[ccm.store,{store:"we_ss18_market_components",url:"https://ccm.inf.h-brs.de"}],user:[ccm.instance,"./resources/user.min.js",{element:"name",style:[ccm.load,"./resources/user_hbrs.css"],texts:{login:'<span class="fa fa-sign-in"></span>',login_title:"Login",logout:'<span class="fa fa-sign-out"></span>',logout_title:"Logout",username_title:"this is your username"}}],icons:[ccm.load,"./resources/font-awesome.min.css"],sidemenu:[ccm.instance,"./resources/ccm.menu.min.js",{style:[ccm.load,"./resources/sidemenu.css"],classes:"ccm-menu_market_sidemenu",data:{store:[ccm.store,"./resources/menu.json"],key:"sidemenu"}}],tabmenu:[ccm.instance,"./resources/ccm.menu.min.js",{style:[ccm.load,"./resources/tabs.css"],classes:"ccm-menu_tabs",data:{store:[ccm.store,"./resources/menu.json"],key:"tabmenu"},selected:1}],publish_form:[ccm.component,"./resources/input.min.js",{style:[ccm.load,"./resources/input.css"],data:{store:[ccm.store,"./resources/inputs.json"],key:"publication"}}],rating:[ccm.component,"./resources/rating.min.js",{style:[ccm.load,"./resources/rating.css"],classes:"ccm-rating_market",store:[ccm.store,{store:"we_ss18_market_ratings",url:"https://ccm.inf.h-brs.de"}],mode:"stars"}],title:"Market place for <i>ccm</i> components",icon:{menu:"bars",component:"plug",edit:"pencil"}},Instance:function(){var self=this;var my;var $element;var components;this.init=function(callback){my=ccm.helper.privatize(self,"html","store","user","sidemenu","tabmenu","publish_form","rating","title","icon");my.sidemenu.element=ccm.helper.find(self,".sidemenu");my.sidemenu.onClick=function(entry){renderListView(entry.nr===2);closeSideMenu()};my.tabmenu.element=ccm.helper.find(self,".tabmenu");my.tabmenu.onClick=function(entry,$content,instance){var component=instance.tmp;switch(entry.nr){case 1:renderDetails();break;case 2:renderDemo();break;case 3:renderConfiguration();break}function renderDetails(){$content.html('<div class="details"></div>');if(component.description)renderSection("Description",component.description);renderSection("Informations",ccm.helper.html(my.html.get("info"),{name:ccm.helper.val(component.key),url:ccm.helper.val(component.url),api:ccm.helper.val(component.api),developer:ccm.helper.val(component.developer),licence:ccm.helper.val(component.licence)}));if(!component.api)ccm.helper.find(instance,".api").remove();function renderSection(title,content){var $section=ccm.helper.html(my.html.get("section"),{title:title});$section.find(".content").html(content);ccm.helper.find(instance,".details").append($section)}}function renderDemo(){var html_string='<script src="'+component.url+'"><\/script><ccm-'+component.key+"></ccm-"+component.key+">";$content.html("<iframe>");$content.find("iframe").css({width:"100%",border:"0"})[0].src="data:text/html;charset=utf-8,"+html_string}function renderConfiguration(){$content.html(ccm.helper.html(my.html.get("config"),{change:renderFactory}));var $select=ccm.helper.find(instance,"select");for(var i=0;i<component.factories.length;i++)$select.append('<option value="'+i+'">'+(component.factories[i].label||component.factories[i].component)+"</option>");renderFactory();function renderFactory(){var factory=component.factories[parseInt($select.val())];ccm.helper.find(instance,".preview").html("");factory.config.element=ccm.helper.find(instance,".factory");factory.config.onFinish=function(result){result.element=ccm.helper.find(instance,".preview");console.log(component.url,result);ccm.render(component.url,result)};components.map(function(component){if(component.key===factory.component)ccm.render(component.url,factory.config)})}}};callback()};this.render=function(callback){$element=ccm.helper.element(self);my.store.get({},function(results){components=results;$element.html(ccm.helper.html(my.html.get("main"),{icon:ccm.helper.val(my.icon.menu),title:ccm.helper.val(my.title),click_overlay:closeSideMenu,click_icon:openSideMenu,click_title:function(){renderListView()}}));if(my.user)my.user.render();renderListView();if(callback)callback()})};function openSideMenu(){var $sidemenu=ccm.helper.find(self,".sidemenu");$sidemenu.addClass("active");ccm.helper.find(self,".overlay").addClass("active");ccm.helper.find(self,".view").addClass("disabled");my.sidemenu.render(function(){var width=$sidemenu.width();$sidemenu.css("left",-width).animate({left:"+="+width})})}function closeSideMenu(){var $sidemenu=ccm.helper.find(self,".sidemenu");ccm.helper.find(self,".overlay").removeClass("active");ccm.helper.find(self,".view").removeClass("disabled");$sidemenu.animate({left:"-="+$sidemenu.width()},function(){$sidemenu.html("");$sidemenu.removeClass("active")})}function renderListView(show_not_quality_proved){ccm.helper.find(self,".content").html('<div class="list_view">');var $list_view=ccm.helper.find(self,".list_view");if(!show_not_quality_proved)renderPublishEntry();components.sort(function(a,b){return a.title.toUpperCase().localeCompare(b.title.toLocaleUpperCase())});for(var i=0;i<components.length;i++)renderEntry(components[i]);function renderPublishEntry(){$list_view.append(ccm.helper.html(my.html.get("entry"),{classes:" publish",tooltip:"Add a new component to this market place",icon:"plus",title:"Add your own component",click:function(){renderPublishView()}}))}function renderEntry(component){$list_view.append(ccm.helper.html(my.html.get("entry"),{classes:"",tooltip:ccm.helper.val(component.abstract)||"",icon:ccm.helper.val(component.icon||my.icon.component),title:ccm.helper.val(component.title||component.key),developer:ccm.helper.val(component.developer),click:function(){renderComponentView(component)}}));renderRating(ccm.helper.find(self,$list_view,".rating:last"),component.key)}}function renderPublishView(component){ccm.helper.find(self,".content").html('<div class="publish_view"></div>');my.publish_form.render({parent:self,element:ccm.helper.find(self,".publish_view"),edit:component?{store:my.store,key:component.key,no_set:true}:null,form:component?"Save":"Publish",fieldset:component?"Edit Component":"Publish Form",onFinish:onFinish});function onFinish(result){my.user.login(function(){result.user=my.user.data().key;result.developer=my.user.data().key;var filename=result.url.split("/").pop();if(!ccm.helper.regex("filename").test(filename))return alert("Your component filename has not a valid value.");var split=filename.split(".");if(split[0]==="ccm")split.shift();split.pop();if(split[split.length-1]==="min")split.pop();result.key=split.join(".");for(var i=0;i<components.length;i++)if(components[i].key===result.key&&(!component||components[i].user!==result.user))return alert("Unique name of component already exists. Try another.");if(!result.title)result.title=result.key;my.store.set(result,function(){if(component&&result.key!==component.key)my.store.del(component.key,proceed);else proceed();function proceed(){alert("Saved!"+(component?"":' You find your published component in the "Not Quality Proved" section until it\'s quality checked.'));self.render()}})})}}function renderComponentView(component){ccm.helper.find(self,".content").html('<div class="component_view">');var $component_view=ccm.helper.find(self,".component_view");$component_view.html(ccm.helper.html(my.html.get("component"),{icon:ccm.helper.val(component.icon||my.icon.component),title:ccm.helper.val(component.title||component.key),abstract:ccm.helper.val(component.abstract)||"",edit:my.icon.edit,click:onClick}));var isPublisher=my.user.isLoggedIn()&&my.user.data().key===component.user;if(my.user.isLoggedIn()&&!isPublisher)ccm.helper.find(self,".edit").remove();renderRating(ccm.helper.find(self,".rating"),component.key,!isPublisher);my.tabmenu.tmp=component;my.tabmenu.render(function(){if(!component.factories)ccm.helper.find(my.tabmenu,".entry").get(2).remove()});function onClick(){my.user.login(function(){if(my.user.data().key===component.user)renderPublishView(component);else renderComponentView(component)})}}function renderRating($rating,component_name,editable){var html_id="ccm-"+self.index+"-component-"+component_name;$rating.attr("id",html_id);ccm.helper.loading($rating);var config={parent:self,element:jQuery("#"+html_id),key:component_name};if(!editable)config.user=null;my.rating.render(config)}}});