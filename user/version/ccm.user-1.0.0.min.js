(function(){var ccm_version="9.0.0";var ccm_url="https://akless.github.io/ccm/version/ccm-9.0.0.min.js";var component_name="user";var component_obj={name:component_name,version:[1,0,0],config:{html:{logged_in:{id:"logged_in",inner:[{id:"user",inner:"%user%",title:"%name%"},{id:"button",inner:{tag:"button",inner:"Logout",onclick:"%click%"}}]},logged_out:{id:"logged_out",inner:{id:"button",inner:{tag:"button",inner:"Login",onclick:"%click%"}}}},context:true,logged_in:false,sign_on:"guest",guest:{user:"guest",name:"Guest User"}},Instance:function(){var self=this;var my;var dataset=null;var observers=[];var loading=false;var waitlist=[];this.init=function(callback){if(self.context){var context=self.ccm.context.find(self,"user");self.context=context&&context.context||context||false}callback()};this.ready=function(callback){my=self.ccm.helper.privatize(self);if(my.logged_in)self.login(callback);else callback()};this.start=function(callback){if(my.context)return my.context.start(callback);var main_elem=self.isLoggedIn()?self.ccm.helper.html(my.html.logged_in,{user:self.data().user,name:self.data().name,click:function(){self.logout(self.start)}}):self.ccm.helper.html(my.html.logged_out,{click:function(){self.login(self.start)}});self.ccm.helper.setContent(self.element,self.ccm.helper.protect(main_elem));if(callback)callback();return self};this.login=function(callback){if(my.context)return my.context.login(callback);if(self.isLoggedIn()){if(callback)callback();return self}if(loading){waitlist.push([self.login,callback]);return self}switch(my.sign_on){case"guest":success({user:my.guest.user,name:my.guest.name});break;case"demo":self.ccm.load({url:"https://kaul.inf.h-brs.de/login/demo_login.php",params:{realm:"hbrsinfkaul"}},success);break;case"hbrsinfkaul":self.ccm.load({url:"https://kaul.inf.h-brs.de/login/login.php",params:{realm:"hbrsinfkaul"}},success);break;case"VCRP_OpenOLAT":var username=prompt("Please enter your OpenOLAT username");var password=prompt("Please enter your OpenOLAT password");self.ccm.load({url:"https://olat.vcrp.de/restapi/auth/"+username,params:{password:password}},success);break}return self;function success(response){dataset=self.ccm.helper.filterProperties(response,"user","token","name");loading=false;while(waitlist.length>0)self.ccm.helper.action(waitlist.shift());if(self.element)self.start();if(callback)callback();notify(true)}};this.logout=function(callback){if(my.context)return my.context.logout(callback);if(!self.isLoggedIn()){if(callback)callback();return self}if(loading){waitlist.push([self.logout,callback]);return self}switch(my.sign_on){case"guest":success();break;case"demo":self.ccm.load({url:"https://kaul.inf.h-brs.de/login/demo_logout.php",params:{realm:"hbrsinfkaul"}});success();break;case"hbrsinfkaul":self.ccm.load({url:"https://kaul.inf.h-brs.de/login/logout.php",params:{realm:"hbrsinfkaul"}});success();break}return self;function success(){dataset=null;loading=false;while(waitlist.length>0)self.ccm.helper.action(waitlist.shift());if(self.element)self.start();if(callback)callback();notify(false)}};this.isLoggedIn=function(){if(my.context)return my.context.isLoggedIn();return!!dataset};this.data=function(){if(my.context)return my.context.data();return dataset};this.getSignOn=function(){if(my.context)return my.context.getSignOn();return my.sign_on};this.addObserver=function(observer){if(my.context)return my.context.addObserver(observer);observers.push(observer);return self};function notify(event){observers.map(function(observer){observer(event)})}}};var namespace=window.ccm&&ccm.components[component_name];if(namespace){if(namespace.ccm_version)ccm_version=namespace.ccm_version;if(namespace.ccm_url)ccm_url=namespace.ccm_url}if(!window.ccm||!ccm[ccm_version]){var tag=document.createElement("script");document.head.appendChild(tag);tag.onload=register;tag.src=ccm_url}else register();function register(){ccm[ccm_version].component(component_obj)}})();