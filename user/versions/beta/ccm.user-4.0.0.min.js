{var component={name:"user",version:[4,0,0],ccm:"https://akless.github.io/ccm/version/beta/ccm-16.0.0.min.js",config:{html:{logged_in:{id:"logged_in",inner:[{id:"user",inner:"%name%"},{id:"button",inner:{tag:"button",inner:"Logout",onclick:"%click%"}}]},logged_out:{id:"logged_out",inner:{id:"button",inner:{tag:"button",inner:"Login",onclick:"%click%"}}},login_form:{id:"login-form",class:"container",inner:[{id:"loginbox",class:"mainbox col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2",inner:{class:"panel panel-info",inner:[{class:"panel-heading",inner:{class:"panel-title",inner:"Sign in"}},{class:"panel-body",inner:[{tag:"form",id:"loginform",class:"form-horizontal",role:"form",inner:[{class:"input-group",inner:[{tag:"span",class:"input-group-addon",inner:{tag:"i",class:"glyphicon glyphicon-user"}},{tag:"input",id:"login-username",type:"text",class:"form-control",name:"username",placeholder:"username",required:true}]},{class:"input-group",inner:[{tag:"span",class:"input-group-addon",inner:{tag:"i",class:"glyphicon glyphicon-lock"}},{tag:"input",id:"login-password",type:"password",class:"form-control",name:"password",placeholder:"password",required:true}]},{class:"form-group",inner:{class:"col-sm-12 controls",inner:{tag:"a",id:"btn-login",class:"btn btn-success",onclick:"%login%",inner:"Login"}}}]}]}]}},{id:"signupbox",style:"display:none; margin-top:50px",class:"mainbox col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2",inner:{class:"panel panel-info",inner:[{class:"panel-heading",inner:[{class:"panel-title",inner:"Sign Up"},{style:"float:right; font-size: 85%; position: relative; top:-10px",inner:{tag:"a",id:"signinlink",onclick:"%loginbox%",inner:"Sign In"}}]},{class:"panel-body",inner:{id:"signupform",class:"form-horizontal",role:"form",inner:[{id:"signupalert",style:"display:none",class:"alert alert-danger",inner:[{tag:"p",inner:"Error:"},{}]},{class:"form-group",inner:[{tag:"label",for:"email",class:"col-md-3 control-label",inner:"Email"},{class:" col-md-9",inner:{tag:"input",type:"text",class:"form-control",id:"email",name:"email",placeholder:"Email Address"}}]},{class:"form-group",inner:[{tag:"label",for:"firstname",class:"col-md-3 control-label",inner:"Frist Name"},{class:" col-md-9",inner:{tag:"input",type:"text",class:"form-control",id:"firstname",name:"firstname",placeholder:"First Name"}}]},{class:"form-group",inner:[{tag:"label",for:"lastname",class:"col-md-3 control-label",inner:"Last Name"},{class:" col-md-9",inner:{tag:"input",type:"text",class:"form-control",id:"lastname",name:"lastname",placeholder:"Last Name"}}]},{class:"form-group",inner:[{tag:"label",for:"password",class:"col-md-3 control-label",inner:"Password"},{class:" col-md-9",inner:{tag:"input",type:"text",class:"form-control",id:"password",name:"password",placeholder:"Password"}}]},{class:"form-group",inner:[{tag:"label",for:"icode",class:"col-md-3 control-label",inner:"Invitation Code"},{class:" col-md-9",inner:{tag:"input",type:"text",class:"form-control",id:"icode",name:"icode"}}]},{class:"form-group",inner:{class:"col-md-offset-3 col-md-9",inner:{tag:"button",id:"btn-signup",type:"button",class:"btn btn-primary",inner:[{tag:"i",class:"glyphicon glyphicon-hand-right"},"&nbsp; Sign Up"]}}}]}}]}}]}},context:true,logged_in:false,realm:"guest",guest:"guest"},Instance:function(){const self=this;let my;let $;let owner;let dataset=null;const observers={};let loading=false;const waitlist=[];let parent;this.init=(callback=>{if(self.context){const context=self.ccm.context.find(self,"user");self.context=context&&context.context||context||false}callback()});this.ready=(callback=>{$=self.ccm.helper;my=$.privatize(self);self.logger&&self.logger.log("ready",my);my.logged_in?self.login(callback):callback()});this.start=(callback=>{if(my.context)return my.context.start(callback);self.logger&&self.logger.log("start",self.isLoggedIn());(self.isLoggedIn()?renderLoggedIn:renderLoggedOut)();function renderLoggedIn(){$.setContent(self.element,$.html(my.html.logged_in,{name:self.data().name,click:()=>self.logout(self.start)}))}function renderLoggedOut(){$.setContent(self.element,$.html(my.html.logged_out,{click:()=>self.login(self.start)}))}callback&&callback();return self});this.login=((callback,propagated)=>{if(my.context)return my.context.login(callback,propagated||owner);if(self.isLoggedIn()){callback&&callback();return self}if(loading){waitlist.push([self.login,callback]);return self}switch(my.realm){case"guest":success({id:my.guest});break;case"ccm-demo":self.ccm.load("https://ccm2.inf.h-brs.de",success);break;case"hbrsinfkaul":self.ccm.load({url:"https://kaul.inf.h-brs.de/login/login.php",method:"JSONP",params:{realm:"hbrsinfkaul"}},success);break;case"LEA":lea();break;case"VCRP_OpenOLAT":const username=prompt("Please enter your OpenOLAT username");const password=prompt("Please enter your OpenOLAT password");self.ccm.load({url:"https://olat.vcrp.de/restapi/auth/"+username,params:{password:password}},success);break}return self;function lea(){renderLoginForm(()=>{const username=self.element.querySelector('input[name="username"]').value;const password=self.element.querySelector('input[name="password"]').value;soap({domain:"http://ilias-ccm.bib.h-brs.de",url:"http://ilias-ccm.bib.h-brs.de/webservice/soap/server.php",method:"login",params:{client:"iliasccm",username:username,password:password}},result=>{const token=/>([^>]+::.+)<\/sid>/.exec(result)[1];success({name:username,token:token})},()=>confirm("Try again?")&&lea())})}function renderLoginForm(login){if(self.parent&&self.parent.element&&self.parent.element.parentNode){parent=self.root.parentNode;self.parent.element.style.display="none";self.parent.element.parentNode.appendChild(self.root)}$.setContent(self.element,$.html(my.html.login_form,{login:login,loginbox:()=>{self.element.querySelector("#loginbox").style.display="block";self.element.querySelector("#signupbox").style.display="none"},signup:()=>{self.element.querySelector("#loginbox").style.display="none";self.element.querySelector("#signupbox").style.display="block"}}))}function success(response){dataset=$.filterProperties(response,"user","token");if(parent){parent.appendChild(self.root);self.parent.element.style.display="block"}loading=false;self.logger&&self.logger.log("login",dataset);while(waitlist.length>0)$.action(waitlist.shift());self.element&&self.start();callback&&callback();notify(true,propagated||owner)}});this.logout=((callback,propagated)=>{if(my.context)return my.context.logout(callback,propagated||owner);if(!self.isLoggedIn()){callback&&callback();return self}if(loading){waitlist.push([self.logout,callback]);return self}switch(my.realm){case"guest":success();break;case"ccm-demo":self.ccm.load({url:"https://ccm.inf.h-brs.de",params:{realm:"ccm-demo",token:dataset.token}});success();break;case"hbrsinfkaul":self.ccm.load({url:"https://kaul.inf.h-brs.de/login/logout.php",method:"JSONP",params:{realm:"hbrsinfkaul"}});success();break;case"LEA":soap({domain:"http://ilias-ccm.bib.h-brs.de",url:"http://ilias-ccm.bib.h-brs.de/webservice/soap/server.php",method:"logout",params:{sid:self.data().token}},success);break}return self;function success(){dataset=null;loading=false;self.logger&&self.logger.log("logout");while(waitlist.length>0)$.action(waitlist.shift());self.element&&self.start();callback&&callback();notify(false,propagated||owner)}});this.isLoggedIn=(()=>{if(my.context)return my.context.isLoggedIn();return!!dataset});this.data=(()=>{if(my.context)return my.context.data();return dataset});this.getRealm=(()=>{if(my.context)return my.context.getRealm();return my.realm});this.addObserver=((observer,callback)=>{if(my.context)return my.context.addObserver(observer,callback);observers[observer]=callback;return self});function notify(event,caller){for(const index in observers){if(index===caller)continue;observers[index](event)}}function soap(settings,success,error){let params="";for(const key in settings.params)params+="<"+key+">"+settings.params[key]+"</"+key+">";const xml=`<?xml version="1.0" encoding="utf-8"?>\n        <SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"\n          SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">\n        <SOAP-ENV:Body>\n          <m:${settings.method} xmlns:m="${settings.domain}">\n             ${params}\n          </m:${settings.method}>\n        </SOAP-ENV:Body>\n      </SOAP-ENV:Envelope>`;const request=new XMLHttpRequest;request.open("POST",settings.url,true);request.setRequestHeader("Content-Type","text/xml");request.onreadystatechange=(()=>{if(request.readyState!==4)return;if(request.status===200&&success)success(request.response);if(request.status!==200&&error)error(request.response,request.status)});request.send(xml)}}};function p(){window.ccm[v].component(component)}const f="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[f])window.ccm.files[f]=component;else{const n=window.ccm&&window.ccm.components[component.name];n&&n.ccm&&(component.ccm=n.ccm),"string"==typeof component.ccm&&(component.ccm={url:component.ccm});var v=component.ccm.url.split("/").pop().split("-");if(v.length>1?(v=v[1].split("."),v.pop(),"min"===v[v.length-1]&&v.pop(),v=v.join(".")):v="latest",window.ccm&&window.ccm[v])p();else{const e=document.createElement("script");document.head.appendChild(e),component.ccm.integrity&&e.setAttribute("integrity",component.ccm.integrity),component.ccm.crossorigin&&e.setAttribute("crossorigin",component.ccm.crossorigin),e.onload=function(){p(),document.head.removeChild(e)},e.src=component.ccm.url}}}