(function(){var component={name:"user",version:[1,1,0],ccm:{url:"https://akless.github.io/ccm/version/ccm-10.2.0.min.js",integrity:"sha384-c4JExvSiTu8tS1LXUqYkV7F/QGezHWYES5DK/9wka6cq4Y0ZX0Q68GEcLSOb4van",crossorigin:"anonymous"},config:{html:{logged_in:{id:"logged_in",inner:[{id:"user",inner:"%user%",title:"%name%"},{id:"button",inner:{tag:"button",inner:"Logout",onclick:"%click%"}}]},logged_out:{id:"logged_out",inner:{id:"button",inner:{tag:"button",inner:"Login",onclick:"%click%"}}}},context:true,logged_in:false,sign_on:"guest",guest:"guest"},Instance:function(){var self=this;var my;var dataset=null;var observers={};var loading=false;var waitlist=[];this.init=function(callback){if(self.context){var context=self.ccm.context.find(self,"user");self.context=context&&context.context||context||false}callback()};this.ready=function(callback){my=self.ccm.helper.privatize(self);if(my.logged_in)self.login(callback);else callback()};this.start=function(callback){if(my.context)return my.context.start(callback);var main_elem=self.isLoggedIn()?self.ccm.helper.html(my.html.logged_in,{user:self.data().user,name:self.data().name,click:function(){self.logout(self.start)}}):self.ccm.helper.html(my.html.logged_out,{click:function(){self.login(self.start)}});self.ccm.helper.setContent(self.element,self.ccm.helper.protect(main_elem));if(callback)callback();return self};this.login=function(callback,propagated){if(my.context)return my.context.login(callback,true);if(self.isLoggedIn()){if(callback)callback();return self}if(loading){waitlist.push([self.login,callback]);return self}switch(my.sign_on){case"guest":success({user:my.guest});break;case"demo":self.ccm.load({url:"https://ccm.inf.h-brs.de",params:{realm:"ccm"}},success);break;case"hbrsinfkaul":self.ccm.load({url:"https://kaul.inf.h-brs.de/login/login.php",params:{realm:"hbrsinfkaul"}},success);break;case"VCRP_OpenOLAT":var username=prompt("Please enter your OpenOLAT username");var password=prompt("Please enter your OpenOLAT password");self.ccm.load({url:"https://olat.vcrp.de/restapi/auth/"+username,params:{password:password}},success);break}return self;function success(response){dataset=self.ccm.helper.filterProperties(response,"user","token");loading=false;while(waitlist.length>0)self.ccm.helper.action(waitlist.shift());if(self.element)self.start();if(callback)callback();notify(true,propagated)}};this.logout=function(callback,propagated){if(my.context)return my.context.logout(callback,true);if(!self.isLoggedIn()){if(callback)callback();return self}if(loading){waitlist.push([self.logout,callback]);return self}switch(my.sign_on){case"guest":success();break;case"demo":self.ccm.load({url:"https://ccm.inf.h-brs.de",params:{realm:"ccm",token:dataset.token}});success();break;case"hbrsinfkaul":self.ccm.load({url:"https://kaul.inf.h-brs.de/login/logout.php",params:{realm:"hbrsinfkaul"}});success();break}return self;function success(){dataset=null;loading=false;while(waitlist.length>0)self.ccm.helper.action(waitlist.shift());if(self.element)self.start();if(callback)callback();notify(false,propagated)}};this.isLoggedIn=function(){if(my.context)return my.context.isLoggedIn();return!!dataset};this.data=function(){if(my.context)return my.context.data();return dataset};this.getSignOn=function(){if(my.context)return my.context.getSignOn();return my.sign_on};this.addObserver=function(observer,callback){if(my.context)return my.context.addObserver(observer,callback);observers[observer]=callback;return self};function notify(event,propagated){for(var index in observers){if(!propagated&&self.parent&&self.parent.index===index)continue;observers[index](event)}}}};function p(){window.ccm[v].component(component)}var f="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[f])window.ccm.files[f]=component;else{var n=window.ccm&&window.ccm.components[component.name];n&&n.ccm&&(component.ccm=n.ccm),"string"==typeof component.ccm&&(component.ccm={url:component.ccm});var v=component.ccm.url.split("/").pop().split("-");if(v.length>1?(v=v[1].split("."),v.pop(),"min"===v[v.length-1]&&v.pop(),v=v.join(".")):v="latest",window.ccm&&window.ccm[v])p();else{var e=document.createElement("script");document.head.appendChild(e),component.ccm.integrity&&e.setAttribute("integrity",component.ccm.integrity),component.ccm.crossorigin&&e.setAttribute("crossorigin",component.ccm.crossorigin),e.onload=function(){p(),document.head.removeChild(e)},e.src=component.ccm.url}}})();