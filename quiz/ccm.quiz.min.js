(function(){var filename="ccm.quiz.min.js";var ccm_version="9.0.0";var ccm_url="https://akless.github.io/ccm/version/ccm-9.0.0.min.js";var component_name="quiz";var component_obj={name:component_name,config:{questions:{},html:{start:{id:"start",inner:{tag:"button",inner:"Start",onclick:"%%"}},main:{id:"main",inner:[{id:"questions"},{id:"buttons",inner:[{id:"cancel"},{id:"prev"},{id:"submit"},{id:"next"},{id:"finish"},{id:"timer"}]}]},question:{id:"%id%","class":"question",inner:[{"class":"title",inner:[{inner:"Question"},{inner:"%nr%/%count%"},{inner:"%text%"}]},{"class":"description",inner:"%description%"},{"class":"answers"}]},answer:{id:"%id%","class":"answer %class%",inner:{"class":"entry",inner:[{"class":"text",inner:{tag:"label",inner:"%text%","for":"%id%-input"}},{"class":"comment"}]}},comment:{"class":"tooltip",inner:["i",{tag:"div","class":"tooltiptext",inner:{inner:{inner:"%%"}}}]},timer:{tag:"span",inner:"%%"}},css:["ccm.load","https://akless.github.io/ccm-components/quiz/resources/default.css"],placeholder:{cancel:"Cancel",prev:"Previous",submit:"Submit",next:"Next",correct:"Correct solution: ",finish:"Finish"}},Instance:function(){var self=this;var my;this.init=function(callback){evaluateLightDOM();callback();function evaluateLightDOM(){if(!self.inner)return;var questions=[];self.ccm.helper.makeIterable(self.inner.children).map(function(question_tag){if(question_tag.tagName!=="CCM-QUIZ-QUESTION")return;var question=self.ccm.helper.generateConfig(question_tag);question.answers=[];self.ccm.helper.makeIterable(question.inner.children).map(function(answer_tag){if(answer_tag.tagName!=="CCM-QUIZ-ANSWER")return;var answer=self.ccm.helper.generateConfig(answer_tag);delete answer.inner;question.answers.push(answer)});delete question.inner;questions.push(question)});if(questions.length>0)self.questions=questions}};this.ready=function(callback){my=self.ccm.helper.privatize(self);uniformData();callback();function uniformData(){if(!Array.isArray(my.questions))my.questions=[my.questions];my.questions.map(function(question,i){question.nr=i+1;question.id="question-"+question.nr;self.ccm.helper.integrate(self.ccm.helper.filterProperties(my,"text","description","answers","input","attributes","swap","encode","random","correct"),question,true);if(!question.input)question.input="checkbox";if(!Array.isArray(question.answers))question.answers=[question.answers];for(i=0;i<question.answers.length;i++)if(!self.ccm.helper.isObject(question.answers[i]))question.answers[i]={text:question.answers[i]};if(question.input!=="radio"&&!Array.isArray(question.correct))question.correct=[question.correct];if(question.input==="checkbox"&&typeof question.correct[0]==="number"){var correct=[];for(i=0;i<question.answers.length;i++)correct.push(question.correct.indexOf(i)>=0);question.correct=correct}if(Array.isArray(question.correct))for(i=0;i<question.answers.length;i++)if(question.correct[i]===undefined)question.correct[i]=question.input==="checkbox"?false:"";question.answers.map(function(answer,i){answer.nr=i+1;answer.class="answer-"+answer.nr;answer.id=question.id+"-"+answer.class;if(answer.correct!==undefined)if(question.input==="radio")question.correct=i;else question.correct[i]=question.input==="number"?parseInt(answer.correct):answer.correct;self.ccm.helper.integrate(self.ccm.helper.filterProperties(question,"attributes","swap","encode"),answer,true)});delete question.attributes;delete question.swap});delete my.text;delete my.description;delete my.answers;delete my.input;delete my.attributes;delete my.swap;delete my.encode;delete my.random;delete my.correct}};this.start=function(callback){if(self.logger)self.logger.log("render");if(my.start_button)self.ccm.helper.setContent(self.element,self.ccm.helper.html(my.html.start,start));else start();if(callback)callback();function start(){var current_question=0;var evaluated={};var results={details:[]};if(self.logger)self.logger.log("start",my);var main_elem=self.ccm.helper.html(my.html.main);var cancel_elem=main_elem.querySelector("#cancel");var prev_elem=main_elem.querySelector("#prev");var next_elem=main_elem.querySelector("#next");var submit_elem=main_elem.querySelector("#submit");var finish_elem=main_elem.querySelector("#finish");var timer_elem=main_elem.querySelector("#timer");if(!my.cancel_button)self.ccm.helper.removeElement(cancel_elem);if(!my.navigation)self.ccm.helper.removeElement(prev_elem);if(!my.feedback)self.ccm.helper.removeElement(submit_elem);if(my.questions.length===1){self.ccm.helper.removeElement(prev_elem);self.ccm.helper.removeElement(next_elem)}if(my.shuffle)self.ccm.helper.shuffleArray(my.questions);my.questions.map(renderQuestion);showQuestion();renderTimer();self.ccm.helper.setContent(self.element,main_elem);if(self.onstart)self.onstart(self);function renderQuestion(question,i){question.i=i;question.elem=self.ccm.helper.html(my.html.question,{id:question.id,nr:i+1,count:my.questions.length,text:question.encode?self.ccm.helper.htmlEncode(question.text):question.text,description:question.description});if(!question.description)self.ccm.helper.removeElement(question.elem.querySelector(".description"));if(question.random)self.ccm.helper.shuffleArray(question.answers);question.answers.map(renderAnswer);main_elem.querySelector("#questions").appendChild(question.elem);function renderAnswer(answer){answer.elem=self.ccm.helper.html(my.html.answer,{id:answer.id,"class":answer.class,text:answer.encode?self.ccm.helper.htmlEncode(answer.text):answer.text});addInput();question.elem.querySelector(".answers").appendChild(answer.elem);function addInput(){var input_html={tag:"input",type:question.input,name:answer.id,id:answer.id+"-input",oninput:function(){var event_data={question:question.nr,answer:answer.nr,value:this.value};if(self.logger)self.logger.log("input",event_data);if(self.oninput)self.oninput(self,event_data)},onchange:function(){var event_data={question:question.nr,answer:answer.nr,value:this.value};if(self.logger)self.logger.log("change",event_data);if(self.onchange)self.onchange(self,event_data)}};if(question.input==="radio"){input_html.name=question.id;input_html.value=answer.nr-1}self.ccm.helper.integrate(answer.attributes,input_html);var entry_elem=answer.elem.querySelector(".entry");var input_elem=self.ccm.helper.html({"class":"input",inner:input_html});entry_elem.insertBefore(input_elem,entry_elem.firstChild);if(answer.swap){entry_elem.insertBefore(entry_elem.children[1],input_elem);entry_elem.classList.add("swap")}}}}function showQuestion(){self.ccm.helper.makeIterable(main_elem.querySelectorAll(".question")).map(function(question_elem){question_elem.style.display="none"});my.questions[current_question].elem.style.display="block";updateButtons()}function updateButtons(){var question=my.questions[current_question];if(my.cancel_button)self.ccm.helper.setContent(cancel_elem,self.ccm.helper.html({tag:"button",inner:my.placeholder.cancel,onclick:function(){if(self.oncancel)self.oncancel(self);else self.start(callback)}}));if(my.navigation)self.ccm.helper.setContent(prev_elem,self.ccm.helper.html({tag:"button",disabled:question.i===0,inner:my.placeholder.prev,onclick:previousQuestion}));self.ccm.helper.setContent(next_elem,self.ccm.helper.protect(self.ccm.helper.html({tag:"button",disabled:question.i===my.questions.length-1||my.feedback&&!my.skippable&&!evaluated[question.nr],inner:my.placeholder.next,onclick:nextQuestion})));if(my.feedback)self.ccm.helper.setContent(submit_elem,self.ccm.helper.html({tag:"button",disabled:evaluated[question.nr],inner:my.placeholder.submit,onclick:function(){evaluate(question)}}));self.ccm.helper.setContent(finish_elem,self.ccm.helper.html({tag:"button",disabled:!my.anytime_finish&&(question.i!==my.questions.length-1||my.feedback&&!evaluated[question.nr]),inner:my.placeholder.finish,onclick:onFinish}));function previousQuestion(){current_question--;showQuestion();var question=my.questions[current_question];var event_data={question_nr:question.i+1,original_nr:question.nr,number_of_questions:my.questions.length};if(self.logger)self.logger.log("prev",event_data);if(self.onprev)self.onprev(self,event_data)}function nextQuestion(){current_question++;showQuestion();var question=my.questions[current_question];var event_data={question_nr:question.i+1,original_nr:question.nr,number_of_questions:my.questions.length};if(self.logger)self.logger.log("next",event_data);if(self.onnext)self.onnext(self,event_data)}}function evaluate(question){if(!question)return my.questions.map(evaluate);if(results.details[question.nr-1])return;var event_data={question_nr:question.i+1,original_nr:question.nr,number_of_questions:my.questions.length,input:getResult()};if(self.onvalidation&&!self.onvalidation(self,self.ccm.helper.clone(event_data)))return;event_data.correct=question.correct;if(self.logger)self.logger.log("feedback",event_data);delete event_data.number_of_questions;results.details[question.nr-1]=event_data;self.ccm.helper.makeIterable(question.elem.querySelectorAll("input")).map(function(input_field){input_field.disabled=true});showFeedback();evaluated[question.nr]=true;if(self.onfeedback)self.onfeedback(self,self.ccm.helper.clone(event_data));updateButtons();function getResult(){var values=self.ccm.helper.formData(question.elem);if(question.input==="radio")return parseInt(values[Object.keys(values)[0]]);var array=[];for(var i in values)array[i.split("-").pop()-1]=question.input==="checkbox"?!!values[i]:values[i];return array}function showFeedback(){question.answers.map(function(answer){if(event_data.correct===undefined)return;if(question.input==="radio")return;var correct=event_data.correct[answer.nr-1];var input=event_data.input[answer.nr-1];if(input!==""&&input!==false&&input===correct)answer.elem.classList.add("right");if(input!==""&&input!==false&&input!==correct)answer.elem.classList.add("wrong");if(input===false&&correct!==false)answer.elem.classList.add("correct");if(question.input!=="checkbox"&&correct!==""&&input!==correct)answer.comment=my.placeholder.correct+correct+(answer.comment?". "+answer.comment:"")});if(event_data.correct===undefined)return renderComments();if(question.input==="radio"){var correct=event_data.correct;var input=event_data.input;var id_prefix="#"+question.id+"-answer-";if(event_data.input===correct)question.elem.querySelector(id_prefix+(input+1)).classList.add("right");else{if(!isNaN(event_data.input))question.elem.querySelector(id_prefix+(input+1)).classList.add("wrong");question.elem.querySelector(id_prefix+(correct+1)).classList.add("correct")}}renderComments();function renderComments(){question.answers.map(function(answer){if(answer.comment)self.ccm.helper.setContent(answer.elem.querySelector(".comment"),self.ccm.helper.html(my.html.comment,answer.encode?self.ccm.helper.htmlEncode(answer.comment):answer.comment))})}}}function renderTimer(){if(!my.time)return self.ccm.helper.removeElement(timer_elem);var timer_value=my.time;timer();function timer(){if(!finish_elem)return;self.ccm.helper.setContent(timer_elem,self.ccm.helper.html(my.html.timer,timer_value));if(timer_value--)self.ccm.helper.wait(1e3,timer);else onFinish()}}function onFinish(){if(self.user)self.user.login(proceed);else proceed();function proceed(){self.ccm.helper.removeElement(finish_elem);self.ccm.helper.removeElement(timer_elem);evaluate();if(self.user)results.user=self.user.data().user;if(self.logger)self.logger.log("finish",results);self.ccm.helper.onFinish(self,results)}}}}}};if(window.ccm&&window.ccm.files)window.ccm.files[filename]=component_obj;var namespace=window.ccm&&ccm.components[component_name];if(namespace){if(namespace.ccm_version)ccm_version=namespace.ccm_version;if(namespace.ccm_url)ccm_url=namespace.ccm_url}if(!window.ccm||!ccm[ccm_version]){var tag=document.createElement("script");document.head.appendChild(tag);tag.onload=register;tag.src=ccm_url}else register();function register(){ccm[ccm_version].component(component_obj);delete window.ccm.files[filename]}})();